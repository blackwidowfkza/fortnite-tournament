<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>FKZA Duo Cash Cup</title>
  <meta content="#1f6feb" name="theme-color"/>
  <meta content="FKZA Duo Cash Cup" property="og:title"/>
  <meta content="Join the FKZA Duo Zero Build Cup - Register, Verify and Compete!" property="og:description"/>
  <meta content="https://i.ibb.co/FbL2kmSn/Untitled-design-1.png" property="og:image"/>
  <meta content="summary_large_image" name="twitter:card"/>
  <link rel="icon" href="https://i.ibb.co/FbL2kmSn/Untitled-design-1.png" type="image/png">
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #0d1117;
      color: #f0f6fc;
    }
    header {
      text-align: center;
      padding: 2rem 1rem 1rem 1rem;
    }
    header img {
      max-height: 160px;
      border-radius: 12px;
      margin-bottom: 0.5rem;
    }
    header h1 {
      font-size: 2.8rem;
      margin: 0.5rem 0;
    }
    #countdown {
      font-size: 1.5rem;
      color: #f9c846;
      margin-top: 0.5rem;
    }
    section {
      max-width: 800px;
      margin: 2rem auto;
      padding: 0 1rem;
    }
    h2 {
      border-bottom: 2px solid #30363d;
      padding-bottom: 0.5rem;
      color: #58a6ff;
    }
    ul, ol {
      line-height: 1.8;
      padding-left: 1.5rem;
    }
    .button {
      background: #238636;
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: bold;
      transition: background 0.2s;
    }
    .button:hover {
      background: #2ea043;
    }
    input {
      width: 100%;
      padding: 0.75rem;
      margin-bottom: 1rem;
      border-radius: 6px;
      border: 1px solid #30363d;
      background: #0d1117;
      color: #f0f6fc;
      font-size: 1rem;
    }
    .registered-duos {
      background: #161b22;
      border-radius: 8px;
      padding: 1rem;
      margin-top: 1rem;
    }
    .registered-duos li {
      padding: 0.75rem 0;
      border-bottom: 1px solid #30363d;
    }
    .max-registered {
      color: #f85149;
      font-weight: bold;
      text-align: center;
      padding: 1.5rem;
      background: #161b22;
      border-radius: 8px;
    }
    .spots-remaining {
      color: #f9c846;
      font-weight: bold;
      margin-top: 1rem;
      text-align: center;
    }
    #submitStatus {
      margin-top: 1rem;
      padding: 0.75rem;
      border-radius: 6px;
      text-align: center;
    }
    .collapsible-toggle {
      cursor: pointer;
      color: #58a6ff;
      margin: 0;
    }
    .collapsible-content {
      display: block;
    }
    .collapsed + .collapsible-content {
      display: none;
    }
    small {
      color: #8b949e;
      display: block;
      margin-top: -0.5rem;
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>
<header>
  <img alt="FKZA Logo" src="https://i.ibb.co/FbL2kmSn/Untitled-design-1.png"/>
  <h1>FKZA Duo Cash Cup</h1>
  <div id="countdown">Loading...</div>
</header>

<section>
  <h2 class="collapsible-toggle">üìÖ Tournament</h2>
  <div class="collapsible-content">
    <ul>
      <li><strong>Date & Time:</strong> 31st May 2025, 7PM SAST</li>
      <li><strong>Format:</strong> Duos</li>
      <li><strong>Game Mode:</strong> Reload Zero Builds</li>
      <li><strong>Server:</strong> EU</li>
    </ul>
  </div>
</section>

<section>
  <h2 class="collapsible-toggle">üì• How to Register</h2>
  <div class="collapsible-content">
    <ol>
      <li><strong>Register your duo</strong> using the form below</li>
      <li><strong>Join our Discord server</strong>: 
        <a href="https://discord.gg/PC5ArHu6" target="_blank">discord.gg/PC5ArHu6</a>
      </li>
      <li><strong>Verify in Discord</strong>:
        <ul>
          <li>Go to the <code>#verify</code> channel</li>
          <li>Link your Epic Games account</li>
        </ul>
      </li>
    </ol>
    <p style="margin-top:1rem;color:#8b949e;">
      <small>Both team members must complete Discord verification.</small>
    </p>
  </div>
</section>

<section>
  <h2 class="collapsible-toggle">üìù Register Your Duo</h2>
  <div class="collapsible-content" id="registrationSection">
    <form id="duoForm">
      <label>Your Discord Username:</label>
      <input id="player" placeholder="e.g. Sypher1234" required type="text"/>
      <small>Enter your exact current Discord username</small>
      
      <label>Duo Partner's Discord Username:</label>
      <input id="duo" placeholder="e.g. Ninja5678" required type="text"/>
      
      <button class="button" type="submit" id="submitButton">Submit Registration</button>
    </form>
    <div id="submitStatus"></div>
  </div>
</section>

<section>
  <h2 class="collapsible-toggle">üèÜ Registered Duos</h2>
  <div class="collapsible-content">
    <div class="registered-duos">
      <ul id="registeredDuosList">
        <li>Loading registered duos...</li>
      </ul>
      <p id="spotsRemaining" class="spots-remaining">Spots remaining: 20/20</p>
    </div>
  </div>
</section>

<!-- Rest of your sections (Prizepool, Scoring, Rules) remain unchanged -->

<script>
  // REPLACE THIS WITH YOUR GOOGLE APPS SCRIPT URL
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxjXKpHLIsys6wLvpwFuM1dVJHIG4ZM2OrwfZVNNlXpmrr7E_Zs7YNcAXZfSFr7rskL/exec";
  const MAX_TEAMS = 20;

  // DOM elements
  const duoForm = document.getElementById("duoForm");
  const submitButton = document.getElementById("submitButton");
  const submitStatus = document.getElementById("submitStatus");
  const registeredDuosList = document.getElementById("registeredDuosList");
  const spotsRemaining = document.getElementById("spotsRemaining");
  const registrationSection = document.getElementById("registrationSection");

  // Initialize
  document.addEventListener('DOMContentLoaded', () => {
    updateCountdown();
    setInterval(updateCountdown, 1000);
    fetchRegistrations();
    setupCollapsibles();
  });

  // Countdown timer
  function updateCountdown() {
    const eventDate = new Date("2025-05-31T17:00:00+02:00"); // SAST timezone
    const now = new Date();
    const diff = eventDate - now;
    const el = document.getElementById("countdown");

    if (diff <= 0) {
      el.textContent = "The tournament is live!";
      return;
    }

    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
    const minutes = Math.floor((diff / (1000 * 60)) % 60);
    const seconds = Math.floor((diff / 1000) % 60);

    el.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;
  }

  // Fetch current registrations
  async function fetchRegistrations() {
    try {
      const response = await fetch(`${SCRIPT_URL}?action=get`);
      const { registrations } = await response.json();
      
      updateRegisteredDuosList(registrations);
      updateSpotsRemaining(registrations.length);
      checkMaxRegistrations(registrations.length);
    } catch (error) {
      console.error("Failed to load registrations:", error);
      registeredDuosList.innerHTML = '<li>Error loading registrations. Please refresh.</li>';
    }
  }

  // Handle form submission
  duoForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    
    const player = document.getElementById("player").value.trim();
    const duo = document.getElementById("duo").value.trim();

    // Validation
    if (!player || !duo) {
      showStatus("‚ùå Please fill in both usernames", "red");
      return;
    }

    submitButton.disabled = true;
    showStatus("Submitting registration...", "#8b949e");

    try {
      const response = await fetch(SCRIPT_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ player, duo })
      });
      
      const result = await response.json();
      
      if (result.success) {
        showStatus("‚úÖ Registration submitted successfully!", "lightgreen");
        document.getElementById("duoForm").reset();
        fetchRegistrations(); // Refresh the list
      } else {
        showStatus("‚ùå Registration failed. Please try again.", "red");
      }
    } catch (error) {
      console.error("Registration error:", error);
      showStatus("‚ùå Network error. Please check your connection.", "red");
    } finally {
      submitButton.disabled = false;
    }
  });

  // Update the registered duos list
  function updateRegisteredDuosList(registrations) {
    if (registrations.length === 0) {
      registeredDuosList.innerHTML = '<li>No duos registered yet</li>';
      return;
    }
    
    registeredDuosList.innerHTML = registrations
      .slice(0, MAX_TEAMS)
      .map(team => `<li>Team ${team.id}: ${team.player} & ${team.duo}</li>`)
      .join('');
  }

  // Update spots remaining counter
  function updateSpotsRemaining(count) {
    const remaining = MAX_TEAMS - count;
    spotsRemaining.innerHTML = `
      Spots remaining: <strong>${remaining > 0 ? remaining : 0}</strong>/${MAX_TEAMS}
      ${remaining <= 0 ? ' (Tournament full)' : ''}
    `;
  }

  // Check if max registrations reached
  function checkMaxRegistrations(count) {
    if (count >= MAX_TEAMS) {
      registrationSection.innerHTML = `
        <div class="max-registered">
          <p>üö® Tournament registrations are now closed!</p>
          <p>Maximum of ${MAX_TEAMS} duos has been reached.</p>
        </div>
      `;
    }
  }

  // Show status messages
  function showStatus(message, color) {
    submitStatus.textContent = message;
    submitStatus.style.color = color;
    submitStatus.style.backgroundColor = color === "lightgreen" ? "rgba(35, 134, 54, 0.1)" : 
                                        color === "red" ? "rgba(248, 81, 73, 0.1)" : 
                                        "rgba(139, 148, 158, 0.1)";
  }

  // Setup collapsible sections
  function setupCollapsibles() {
    document.querySelectorAll('.collapsible-toggle').forEach(h2 => {
      h2.addEventListener('click', () => {
        h2.classList.toggle('collapsed');
        const content = h2.nextElementSibling;
        content.style.display = content.style.display === 'none' ? 'block' : 'none';
      });
    });
  }
</script>
</body>
</html>
